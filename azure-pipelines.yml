trigger:
  branches:
    include:
      - main

pool:
  name: Default

variables:
  demoVar: 'HelloDemo'

stages:

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Build â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- stage: Build
  displayName: 'ğŸ”¨ Build'
  jobs:
  - job: BuildJob
    displayName: 'Compile (echo)'
    steps:
      - script: |
          echo "Building codeâ€¦ $(demoVar)"
        displayName: 'Build step'

      - task: PublishPipelineArtifact@1
        displayName: 'Publish artifact'
        inputs:
          targetPath: .
          artifact: drop

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Deploy â†’ Test â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- stage: DeployToTest
  displayName: 'ğŸš§ Deploy to Test'
  dependsOn: Build
  jobs:
  - deployment: TestDeploy
    displayName: 'Deploy â‡’ Test'
    environment: 'Test'         # â† maps to the â€œTestâ€ environment youâ€™ll create
    pool:
      name: Default
    strategy:
      runOnce:
        deploy:
          steps:
            - download: current
              artifact: drop

            - script: |
                echo "Deploying to TESTâ€¦"
              displayName: 'Echo Test deploy'

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Deploy â†’ Stage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- stage: DeployToStage
  displayName: 'ğŸš§ Deploy to Stage'
  dependsOn: DeployToTest      # only runs once Test is done
  jobs:
  - deployment: StageDeploy
    displayName: 'Deploy â‡’ Stage'
    environment: 'Stage'
    pool:
      name: Default
    strategy:
      runOnce:
        deploy:
          steps:
            - download: current
              artifact: drop

            - script: |
                echo "Deploying to STAGEâ€¦"
              displayName: 'Echo Stage deploy'

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Deploy â†’ Prod â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- stage: DeployToProd
  displayName: 'ğŸš§ Deploy to Prod'
  dependsOn: DeployToStage     # only runs once Stage is done
  jobs:
  - deployment: ProdDeploy
    displayName: 'Deploy â‡’ Prod'
    environment: 'Prod'
    pool:
      name: Default
    strategy:
      runOnce:
        deploy:
          steps:
            - download: current
              artifact: drop

            - script: |
                echo "Deploying to PRODâ€¦"
              displayName: 'Echo Prod deploy'

